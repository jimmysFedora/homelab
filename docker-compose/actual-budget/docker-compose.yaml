services:
  actual_server:
    image: actualbudget/actual-server:26.2.0-alpine@sha256:229da8855047d399fa76f4ca054ec9d1631b3ab74d207dc2a70dfab839bfc3e1
    # ports:
    #   - 5006:5006
    volumes:
      - /mnt/docker-nfs/volumes/actual-data:/data
    healthcheck:
      test: ["CMD-SHELL", "node src/scripts/health-check.js"]
      interval: 60s
      timeout: 10s
      retries: 3
      start_period: 20s
    restart: unless-stopped
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.actual-insecure.rule=Host(`actual-budget.mistyfumes.dev`)"
      - "traefik.http.routers.actual-insecure.entrypoints=http"
      - "traefik.http.routers.actual-insecure.middlewares=https-redirect@file"
      - "traefik.http.routers.actual-secure.rule=Host(`actual-budget.mistyfumes.dev`)"
      - "traefik.http.routers.actual-secure.entrypoints=https"
      - "traefik.http.routers.actual-secure.tls=true"
      - "traefik.http.routers.actual-secure.tls.certresolver=cloudflare"
      - "traefik.http.services.actual.loadbalancer.server.port=5006"
    networks: 
      - frontend

networks:
  frontend:
    external: true